<?phpinclude_once 'bootstrap.php';$aStation = array();$aStation[] = array('id' => 468, 'nom' => "lignon du forez (Boen-sur-Lignon)");$aStation[] = array('id' => 469, 'nom' => "lignon du forez (Poncins)");$aStation[] = array('id' => 470, 'nom' => "Loire (Balbigny)");$aStation[] = array('id' => 463, 'nom' => "Loire (Montrond-les-bains)");$aStation[] = array('id' => 455, 'nom' => "Loire (Grangent)");$aStation[] = array('id' => 5151, 'nom' => "Rhône (Ternay)");$aStation[] = array('id' => 5151, 'nom' => "Rhône (Pont-Morand)");//$iProfondeur = 24;//1 jour//$iProfondeur = 72;//3 jours//$iProfondeur = 168;//7 jours$iProfondeur = 369;//16 jours //maximum que j'ai pu voir pour sur siteforeach ($aStation as $uneStation){	//$stationId = 468;	//$stationNom = "lignon du forez (Boen-sur-Lignon)";	$stationId = $uneStation['id'];	$stationNom = $uneStation['nom'];	$sUrl = 'http://www.vigicrues.gouv.fr/niveau3.php?idstation='.$stationId.'&typegraphe=q&AffProfondeur='.$iProfondeur.'&AffRef=auto&nbrstations=41&ong=1&Submit=Refaire+le+graphique+-+Valider+la+s%C3%A9lection';	$homepage = file_get_contents($sUrl);	$subject = $homepage;	$pattern = '/area.*/';	//preg_match($pattern, $subject, $matches, PREG_OFFSET_CAPTURE, 3);	preg_match_all($pattern, $subject, $matches, PREG_OFFSET_CAPTURE, 3);	//echo '<pre>' . print_r($matches, true) . '</pre>';	foreach ($matches[0] as $key => $aValue)	{		$sArea = $aValue[0];		$sNumCaract = $aValue[1];				//echo $sArea . '<br/>';				//$pattern = '/area		//$pattern2 = '/title=\"(.*)\" /';		//$pattern2 = '/title=\"[0-9a-zA-Z]\"/';		$pattern2 = '/title=\"[^\"]*/';		//preg_match($pattern, $sArea, $matches, PREG_OFFSET_CAPTURE, 3);		preg_match_all($pattern2, $sArea, $matches2, PREG_OFFSET_CAPTURE, 3);		//echo '<pre>';var_dump($matches2);		foreach ($matches2[0] as $key2 => $aValue2)		{			$sTitle = $aValue2[0];			$sNumCaractTitle = $aValue2[1];						//echo $sTitle . '<br/>';						$sTitle = str_replace('title="', '', $sTitle);						$aExplode = explode(' ', $sTitle);						$sDate = $aExplode[0];			$sHeure = $aExplode[1];			$sMesure = $aExplode[5];						if ($sHeure != '09:00' && $sHeure != '12:00' && $sHeure != '17:00' && $sHeure != '20:00' && $sHeure != '02:00' && $sHeure != '06:00')			{				continue;			}						echo $sDate . ' ' . $sHeure . ' ' . $sMesure . '<br/>';						$aExplodeDate = explode('/', $sDate);						$oDateDebit = new DateTime($aExplodeDate[2].'-'.$aExplodeDate[1].'-'.$aExplodeDate[0]);			$dateDebit = $oDateDebit->format('Y-m-d') . ' ' . $sHeure;						//INSERT INTO `gestionpeche`.`niv_eau_2` (`station_id`, `station_nom`, `date_debit`, `debit`) VALUES ('468', 'lignon du forez (Boen-sur-Lignon)', '2014-04-15 18:00:00', '3');			$sSql = "INSERT IGNORE INTO `gestionpeche`.`niv_eau_2` (`station_id`, `station_nom`, `date_debit`, `debit`) VALUES ('".$stationId."', '".$stationNom."', '".$dateDebit."', '".$sMesure."');";			echo $sSql . '<br/>';						$result = connectBase::insert( $sSql );		}		//echo '<br/>';	}}//echo $homepage;?>